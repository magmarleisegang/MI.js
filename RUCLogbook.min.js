function SaveNewRUCLicence(){var i=null,r=null,u,t,n,f,e;if($(".selected").attr("id").indexOf("v")==0&&(i=$(".selected").attr("id").substr(1)),$(".selected").attr("id").indexOf("t")==0&&(r=$(".selected").attr("id").substr(1)),u=$("#txtLicPurchaseDate").val(),t=CheckDate("#txtLicPurchaseDate",""),t!==!0)return SetLicError(t),!1;if($("#txtLicOpenOdo").val().isNullOrEmpty())return SetLicError("Please enter a starting odo value."),!1;if($("#txtLicCloseOdo").val().isNullOrEmpty())return SetLicError("Please enter an ending odo value."),!1;if(Number($("#txtLicOpenOdo").val())>=Number($("#txtLicCloseOdo").val()))return SetLicError("Ending odo must be larger than starting odo."),!1;if(n=$("#txtLicValue").val(),n.isNullOrEmpty())return SetLicError("Please enter a licence $ cost per km."),!1;if(n.replace(/\./,0).search(/\D/g)>-1)return SetLicError("Licence $ cost per km can't contain letters."),!1;f=Number($("#txtLicCloseOdo").val())-Number($("#txtLicOpenOdo").val()),n=(parseFloat(n)*f).toFixed(4),e={vehicleId:i,trailerId:r,licenceNumber:$("#txtLicNumber").val().toString(),openingOdo:$("#txtLicOpenOdo").val().toString(),closingOdo:$("#txtLicCloseOdo").val().toString(),purchaseDate:u,value:n,odoType:$("#ddlOdoType").val().toString(),reasonCode:$("#ddlRUCReasonCode").val().toString()},DoAjax({data:JSON.stringify(e),url:"/ReportingWebService.asmx/SaveRUCLicence",successCallback:function(n){if(n.d!=undefined)if(n.d[0]==!0)n.d[1]!=null&&location.reload();else if(n.d.length>1&&n.d[1].indexOf("ER")==0)return SetLicError(n.d[1].substring(n.d[1].indexOf(":")+1)),!1},errorCallback:function(n,t){t!=undefined?alertUI(t,3e3):alertUI(),LogError(n.responseText,"Logbook Page","1073")}})}function LoadRUCLicence(n){$("html").css("cursor","wait");var t={licenceId:n};DoAjax({data:JSON.stringify(t),url:"/ReportingWebService.asmx/LoadRUCLicence",successCallback:function(n){if($("html").css("cursor","default"),OpenRUCLicencePopup(),n.d!=undefined)if(n.d[0]==!0)if(n.d[1]!=null){var t=n.d[1],i=new Date(parseInt(t.dtPurchaseDateUtc.replace(/\D/g,""))),r=i.getDate().doubleDigit()+"/"+(i.getMonth()+1).doubleDigit()+"/"+i.getFullYear();$("#txtLicPurchaseDate").val(r),$("#txtLicValue").val((t.dValue/(t.iClosingOdoReading-t.iOpeningOdoReading)).toFixed(4)),$("#txtLicNumber").val(t.sRUCLicenceNumber),$("#txtLicOpenOdo").val(t.iOpeningOdoReading),$("#txtLicCloseOdo").val(t.iClosingOdoReading),$("#ddlOdoType").val(t.bOdoReadingType),$("#ddlRUCReasonCode").val(t.sRUCReasonCode)}else return SetLicError("Licence not found."),!1;else if(n.d.length>1&&n.d[1].indexOf("ER")==0)return SetLicError(n.d[1].substring(n.d[1].indexOf(":")+1)),!1},errorCallback:function(n,t){t!=undefined?alertUI(t,3e3):alertUI(),LogError(n.responseText,"Logbook Page","205")}})}function EditRUCLicence(n){var f=$("#txtLicPurchaseDate").val(),i=CheckDate("#txtLicPurchaseDate",""),t,r,u;if(i!==!0)return SetLicError(i),!1;if($("#txtLicOpenOdo").val().isNullOrEmpty())return SetLicError("Please enter a starting odo value."),!1;if($("#txtLicCloseOdo").val().isNullOrEmpty())return SetLicError("Please enter an ending odo value."),!1;if(Number($("#txtLicOpenOdo").val())>=Number($("#txtLicCloseOdo").val()))return SetLicError("Ending odo must be larger than starting odo."),!1;if(t=$("#txtLicValue").val(),t.isNullOrEmpty())return SetLicError("Please enter a licence value."),!1;if(t.replace(/\./,0).search(/\D/g)>-1)return SetLicError("Licence value can't contain letters."),!1;r=Number($("#txtLicCloseOdo").val())-Number($("#txtLicOpenOdo").val()),t=(parseFloat(t)*r).toFixed(4),u={licenceId:n,licenceNumber:$("#txtLicNumber").val().toString(),openingOdo:$("#txtLicOpenOdo").val().toString(),closingOdo:$("#txtLicCloseOdo").val().toString(),purchaseDate:f,value:t,odoType:$("#ddlOdoType").val().toString(),reasonCode:$("#ddlRUCReasonCode").val().toString()},DoAjax({data:JSON.stringify(u),url:"/ReportingWebService.asmx/EditRUCLicence",successCallback:function(n){if(n.d!=undefined)if(n.d[0]==!0)n.d[1]!=null&&location.reload();else if(n.d.length>1&&n.d[1].indexOf("ER")==0)return SetLicError(n.d[1].substring(n.d[1].indexOf(":")+1)),!1},errorCallback:function(n,t){t!=undefined?alertUI(t,3e3):alertUI(),LogError(n.responseText,"Logbook Page","205")}})}function CloseRUCLicence(n){var t=null,i,r;if(!n&&(t=$("#txtLicCloseDate").val(),i=CheckDate("#txtLicCloseDate",""),i!==!0))return SetLicError(i),!1;licenceId=$("#hdnSelectedLicId").val(),r={RUCLicenceId:licenceId,closeDate:t},DoAjax({data:JSON.stringify(r),url:"/ReportingWebService.asmx/CloseRUCLicence",successCallback:function(n){if(n.d!=undefined)if(n.d[0]==!0)n.d[1]!=null&&location.reload();else if(n.d.length>1&&n.d[1].indexOf("ER")==0)return SetLicError(n.d[1].substring(n.d[1].indexOf(":")+1)),!1},errorCallback:function(n,t){t!=undefined?alertUI(t,3e3):alertUI(),LogError(n.responseText,"Logbook Page","1167")}})}function OpenRUCLicencePopup(){var n=new Date,t=n.getDate().doubleDigit()+"/"+(n.getMonth()+1).doubleDigit()+"/"+n.getFullYear();$("#txtLicPurchaseDate").val(t),$("#txtLicStartDate").val(t),$("#txtLicNumber").val(null),$("#txtLicOpenOdo").val(null),$("#txtLicCloseOdo").val(null),$("#txtLicValue").val(null),$("#ddlRUCReasonCode").val(1),$("#ddlOdoType").val(1),$("#dvRucLicence div.NewRucLicence").show(),$("#dvRucLicence div.CloseRucLicence").hide(),SetExpError(),$.blockUI({message:$("#dvRucLicence"),css:{borderWidth:"0px",top:"0px",left:"0px"}})}function OpenCloseRUCLicencePopup(){var n=new Date,t=n.getDate().doubleDigit()+"/"+(n.getMonth()+1).doubleDigit()+"/"+n.getFullYear();$("#txtLicCloseDate").val(t),$("#dvRucLicence div.CloseRucLicence").show(),$("#dvRucLicence div.NewRucLicence").hide(),$.blockUI({message:$("#dvRucLicence"),css:{borderWidth:"0px",top:"0px",left:"0px"}})}function OpenRUCLicenceReportPopup(){$("#processingWarning").hide(),DoAjax({data:null,url:"/ReportingWebService.asmx/IsUserTripProcessingBusy",successCallback:function(n){n.d!=undefined&&n.d[0]==!0&&(n.d[1]==!0||n.d[2]==!0)&&$("#processingWarning").show()},errorCallback:function(){}}),$.blockUI({message:$("#dvRucLicenceReport"),css:{borderWidth:"0px",top:"0px",left:"0px"}})}$(".DeleteRUCLicence").click(function(n){var i,r,t;if(n.preventDefault(),n.stopPropagation(),n.target.tagName=="A"&&(i=n.target.id,i.indexOf("d")==0)){for(i=i.substr(1),r=n.target,t=r;t.tagName!="TR";)t=t.parentNode;if(confirm("Are you sure you want to delete RUC Licence "+$.trim(t.children[0].innerHTML)+"?"))alertUI("Deleting licence..."),DoAjax({data:'{"iRUCLicenceId":'+i+" }",url:"/ReportingWebService.asmx/DeleteRUCLicence",successCallback:function(n){if(n.d[0]==!0){if($(t).remove(),$("#tblExpReadings tbody tr").length==0)if($("#trNoLicences").length==0)$("#tblRUCLicneces tbody").append("<tr id='trNoExp'><td colspan='10'>No RUC Licences to display<\/td><\/tr>");else $("#trNoExp").show();alertUI()}else n.d[1].indexOf("ER")==0?alertUI(n.d[1].split(":")[1],3e3):alertUI("Oops! We failed to delete this licence.",5e3)},errorCallback:function(n,t){t!=undefined&&alertUI(t,3e3),LogError(n.responseText,"Logbook Page","267")}});else return!1}}),$("div.RucLicenceReport input.chkReportLicence").live("mousedown",function(n){$("div.RucLicenceReport input.chkReportLicence:checked").length>=8&&n.target.checked==!1&&(alert("You can only report on 8 licenses at a time."),n.preventDefault())})