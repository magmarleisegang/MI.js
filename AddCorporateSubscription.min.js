function CheckQuoteAJAX(){$("#Img1").hide(),Calculating(!0);var n=SubscriptionList.GetAllSelected("ctrlSubsSelector");if(n.length!=1){Calculating();return}bundle=GetSelectedBundle(),DoAjax({url:"/PrivatePages/Corporate/CorporateWebService.asmx/GetQuote",data:'{"iTypeId": '+n+',"bundleId":'+bundle.iBundleId+"}",successCallback:function(n){n.d[0]==!1?alertUI(n.d[1],3e3):($("#grdQuote tbody").empty(),$(n.d[1]).each(function(n,t){rowTemplate.add(t)}),SetTotal(n.d[1][0].Currency))},completeCallback:Calculating},"Please wait...")}function Calculating(n){n===!0?showCalc=setTimeout(function(){$("#pQuote_Calculating").show()},1e3):(clearTimeout(showCalc),$("#pQuote_Calculating").hide())}function SetTotal(n){var t=0;$("#grdQuote tbody tr").each(function(n,i){t+=parseFloat($(i).children("td.amount").text())}),$("#grdQuote tfoot td.total span.cur").text(n),$("#grdQuote tfoot td.total span.total").text(t.toFixed(2))}function Pay(n){var r=SubscriptionList.GetAllSelected("ctrlSubsSelector")[0],i,t;if(r==undefined)return alert("Please select a subscription"),n.preventDefault(),n.stopPropagation(),!1;n.preventDefault(),n.stopPropagation(),i=$("#ddlPaymentGateway").length>0?$("#ddlPaymentGateway").val():$("#hidPaymentGateway").val(),t=null,$("#rdNew").length>0&&$("#rdNew:checked").length==0&&(t=$("#ddlCurrentPaymentInfos").val()),PaymentScript.CallPaymentService("../../SubscriptionWebService.asmx/UserAddSubscription",'{"gatewaySetting": '+i+', "paymentInfoId":'+t+"}",null,"Creating Subscriptions")}function SetBundleDdl(){var i=SubscriptionList.GetAllSelected("ctrlSubsSelector"),n,t;if(i.length!=1){Calculating();return}n=bundles.TryGet(i[0]),n!=undefined?(t=$("#ddlBundleSize"),t.empty(),t.html(n),CheckQuoteAJAX()):alert("shit")}function BundlePrice(n){if($("#ddlBundleSize").val()!="0-0-0"){var t=$("#ddlBundleSize").val().split("-");n.Price=parseFloat(t[2]),n.BundleDescription=$("#ddlBundleSize option[value='"+$("#ddlBundleSize").val()+"']").text()}}function GetSelectedBundle(){var n=$("#ddlBundleSize option:selected");return{iBundleId:parseInt(n.val()),dPrice:n.data("p"),iSize:n.data("s")}}var quoteTotal=0,rowTemplate,showCalc,bundles;SubscriptionBundles=function(){},SubscriptionBundles.prototype=[],SubscriptionBundles.prototype.constructor=SubscriptionBundles,$(document).ready(function(){rowTemplate=$("#grdQuote tbody").createTemplater("#subscriptionQuoteTemplate"),Calculating();var n=$("#txtAddCorporate_Count");$("#btnCorpSub_Ok").click(Pay),$("#ddlBundleSize").change(CheckQuoteAJAX),$("#ddlPaymentGateway").change(function(){$.blockUI&&alertUI("Please wait...")}),SubscriptionList.Bind(SetBundleDdl),bundles=new SubscriptionBundles,SubscriptionList.SetSelected("ctrlSubsSelector"),CheckQuoteAJAX()}),SubscriptionBundles.prototype.TryGet=function(n){for(var u=this.length,r,i,t=0;t<u;t++)if(this[t].Type==n)return this[t].OptionString;return r=this,i=null,DoAjax({data:'{"id":'+n+"}",url:"/PrivatePages/Corporate/AddCorporateSubscription.aspx/GetBundleString",doAsync:!1,successCallback:function(t){r.push({Type:n,OptionString:t.d[1]}),i=t.d[1]},errorCallback:function(n){alert(n)},doAsync:!1},"Loading Bundles"),i}