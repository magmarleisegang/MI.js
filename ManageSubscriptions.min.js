function CheckPayNowButton(){parseFloat($("#lblCurrentBalance").text().replace(/[R$]/g,""))>0?$("#aPayNow").show():$("#aPayNow").hide()}function FilterStatements(n){var t,i,r,u,f;$("input[type=radio][name=statement-search][value=id]").prop("checked")?(t=$("input#txt-statement-search-id").val(),i=r=null):(t="",i=$("input#txt-statement-search-from").val(),r=$("input#txt-statement-search-to").val()),u=['{"statementid":',t.length>0?t:"null",',"from":"',i,'","to":"',r,'"}'].join(""),f=n?null:function(){},DoAjax({url:"/SubscriptionWebService.asmx/LoadUserStatement",data:u,successCallback:function(n){if(n.d.length>0){var i=$("#userStatementTemplate"),t=$("#divStatement table tbody");t.empty(),$.each(n.d,function(n,r){r.link=r.Type=="Invoice"?"class='link' data-inv":null,t.addOnce(i,r)})}},errorCallback:f,completeCallback:function(){}})}function SetupTabs(){$("div.tab ul li").click(function(){$("div.tab ul li").removeClass("selected"),$("div.sub").addClass("not-selected"),$(this).addClass("selected"),$("div#"+$(this).data("page")).removeClass("not-selected"),Cookie.Create({name:"tp",value:$(this).data("tp")})}),$("div.tab ul li[data-page=divAccountInfo]").addClass("selected")}function CancelSub(n,t,i){DoAjax({url:"/SubscriptionWebService.asmx/UserCancelSubscription",data:'{"subscriptionId":'+t+', "checkUnpaidInvoices":'+i+',"cancelUnpaidInvoices":null}',successCallback:function(i){var r,u;if(i.d[1]==!1)confirmUI("You have unpaid invoices linked to this subscription. If you choose to cancel the invoice/s the subscription period will be altered. Do you still wish to cancel the subscription?",!0,function(i){return i==!0&&CancelSub(n,t,!1),!0});else if(i.d[1]==!0){for(r=n;r.tagName!="TR";)r=r.parentNode;u=$(r),u.children("td.sub-status").text("Cancelled"),u.children("td.sub-expiry").children("span").text(i.d[2]),u.children("td.sub-cancel").empty(),i.d[3]==!0&&FilterStatements(!1),i.d.length==6&&($("#lblCurrentBalance").text(i.d[4]),$("#lblNextPaymentDueDate").text(i.d[5]),CheckPayNowButton())}},errorCallback:function(n,t){alertUI(t,3e3)},completedCallback:alertUI})}function ViewReport(n){if(fBusyProcessingReport==!0)return alertUI("Busy processing report. Please wait!",3e3),!1;fBusyProcessingReport=!0,$("html").css("cursor","wait"),DoAjax({url:"/ReportingWebService.asmx/RenderUserInvoiceReport",data:'{"id":'+n+"}",successCallback:function(n){var t=siteRoot+"/PrivatePages/Reports/ReportRenderer.ashx?GUID="+n.d;document.location=t},completeCallback:function(){fBusyProcessingReport=!1,$("html").css("cursor","default"),alertUI()}})}$(document).ready(function(){if($("#divNamePaymentInfo").length>0)$.blockUI({message:$("#divNamePaymentInfo")}),$("#btnPayment_Save").click(function(n){if($("#txtPaymentInfoUserDesc").val().length==0)return alert("Please enter a description."),n.stopImmediatePropagation(),n.preventDefault(),!1;$.unblockUI({fadeOut:!1})});else{SetupTabs(),CheckPayNowButton(),SetupDatepicker("#divStatementSearch input#txt-statement-search-from",{icon:"#divStatementSearch span.link img[data-cal=from]",otherCalendar:"#divStatementSearch input#txt-statement-search-to"}),SetupDatepicker("#divStatementSearch input#txt-statement-search-to",{icon:"#divStatementSearch span.link img[data-cal=to]",otherCalendar:"#divStatementSearch input#txt-statement-search-from"}),$("table.subs span.link[data-can]").click(function(n){confirmUI("Are you sure you want to cancel this subscription?",!0,function(t){if(t==!0){var i=n.target,r=$(i).data("can");CancelSub(i,r,!0)}return!0})}),$("#divStatementSearch span.link img[alt=Find]").click(function(){FilterStatements(!0)}),$("tr[data-radiotype]").click(function(){$("input[type=radio][value="+$(this).data("radiotype")+"]").prop("checked",!0)}),$("#divChangePI").length==0?$("#btnChangePI").hide():($("#btnChangePI").click(function(n){n.preventDefault(),$("#pChangePI_Existing").length>0?($("#sChangePI_Current").text($("#ctrlPaymentInfo tr:first td:last").text()),$("#pChangePI_Existing").show(),$("#divChangePI_buttons").show(),$("#pChangePI_New").hide(),$.blockUI({message:$("#divChangePI")})):$("#pChangePI_New").length>0&&($("#pChangePI_New").show(),$.blockUI({message:$("#divChangePI")}))}),$("#divChangePI div.buttons a").click(function(n){n.preventDefault(),this.id.indexOf("Cancel")>-1?$.unblockUI():this.id.indexOf("Update")>-1?($("#hidPostbackAction").val(["p",$("#ddlChangePI_Existing").val(),$("#chkChangePI_Existing").prop("checked")].join(",")),document.forms[0].submit()):this.id.indexOf("New")>-1&&($("#pChangePI_Existing").hide(),$("#divChangePI_buttons").hide(),$("#pChangePI_New").show())}),$("#pChangePI_Create").click(function(){var n=$("#ddlChangePI_New").val(),t=$("#chkChangePI_New").prop("checked");PaymentScript.CallPaymentService("../SubscriptionWebService.asmx/NewPaymentInfo",'{"gatewaySettingId":'+n+',"autoCharge":'+t+"}",null," Please wait")})),$("#divStatement table span.link[data-inv]").live("click",function(n){n.preventDefault();var t=parseInt($(this).text().replace(/\D/g,""));ViewReport(t)}),$("#divSubActions img[data-a=rnw]").click(function(n){if(n.preventDefault(),$("input.multi:checked").length>0){var t=[];$("input.multi:checked").each(function(n,i){t.push(i.value)}),DoAjax({url:"/SubscriptionWebService.asmx/MultiRenew",data:'{"subIds":['+t.join(",")+"]}",successCallback:function(n){n.d!=null&&(document.location=n.d)}})}else alertUI("Please select the subscriptions you would like to renew by ticking the boxes in the last column.",3e3)}),$("#divSubActions img[data-a=add]").click(function(){document.location="AddSubscription.aspx"});var t=Cookie.GetValue("tp"),n=new URLParams(document.location.href);n.IsEmpty==!1&&(n.inv!=undefined&&(alertUI("Please wait"),ViewReport(parseInt(n.inv.replace(/\D/g,"")))),n.tp!=undefined&&(t=n.tp)),t!=null&&$("div.tab ul li[data-tp="+t+"]").click()}});var fBusyProcessingReport