function GenerateListOfYears(n,t){var u=new Date,f=document.getElementById(t),r;for(i=0;i<n;i++){r=document.createElement("option"),r.text=u.getFullYear()-i,r.value=u.getFullYear()-i;try{f.add(r,null)}catch(e){f.add(r)}}}function isInteger(n){for(var i,t=0;t<n.length;t++)if(i=n.charAt(t),i<"0"||i>"9")return!1;return!0}function stripCharsInBag(n,t){for(var u="",r,i=0;i<n.length;i++)r=n.charAt(i),t.indexOf(r)==-1&&(u+=r);return u}function daysInFebruary(n){return n%4==0&&(!(n%100==0)||n%400==0)?29:28}function DaysArray(n){for(var t=1;t<=n;t++)this[t]=31,(t==4||t==6||t==9||t==11)&&(this[t]=30),t==2&&(this[t]=29);return this}function isDate(n){var r=new Date,s=DaysArray(12),u=n.indexOf(dtCh),f=n.indexOf(dtCh,u+1),t=n.substring(0,u),i=n.substring(u+1,f),o=n.substring(f+1),e;for(strYr=o,i.charAt(0)=="0"&&i.length>1&&(i=i.substring(1)),t.charAt(0)=="0"&&t.length>1&&(t=t.substring(1)),e=1;e<=3;e++)strYr.charAt(0)=="0"&&strYr.length>1&&(strYr=strYr.substring(1));return(month=parseInt(i),day=parseInt(t),year=parseInt(strYr),u==-1||f==-1)?(alert("The date format should be : yyyy-mm-dd"),!1):i.length<1||month<1||month>12?(alert("Please enter a valid month"),!1):t.length<1||day<1||day>31||month==2&&day>daysInFebruary(year)||day>s[month]?(alert("Please enter a valid day"),!1):o.length!=4||year==0||year<minYear||year>maxYear?(alert("Please enter a valid 4 digit year between "+minYear+" and "+maxYear),!1):n.indexOf(dtCh,f+1)!=-1||isInteger(stripCharsInBag(n,dtCh))==!1?(alert("Please enter a valid date"),!1):year==r.getFullYear()&&(month>r.getMonth()+1||month==r.getMonth()+1&&day>r.getDate())?(alert("Your odometer reading cannot be in the future"),!1):!0}function ValidateDate(n){if(n.value!=undefined&&n.value!=""&&n.value!="yyyy-mm-dd")return isDate(n.value)==!1?(n.focus(),!1):!0}function ValidateInt(n){if(n.value!=undefined&&n.value!=""){var t=parseInt(n.value);return t==-1?(alert("Please enter a value less than 2147483647"),n.focus(),!1):!0}}function isNumberKey(n){var t=n.which?n.which:n.keyCode;return t>31&&(t<48||t>57)?!1:!0}function URLParams(n){var u=n.split("?")[1],i,t,r;if(u==undefined){this.IsEmpty=!0;return}for(i=u.split("&"),this.Count=i.length,t=0;t<this.Count;t++)r=i[t].split("="),this[r[0]]=r[1];this.IsEmpty=!1}function CenterPopups(){var t,i,r,n;addToCrumbtrail("CenterPopups()"),t={height:$(window).height(),width:$(window).width()},i=0,$(".popupBackground").height(t.height-i).width(t.width-i),arguments.length==1&&arguments[0]===!0?(r=$(window).width()-($("#dvGrdViewVehicles").width()+20+80),n=$(window).height()-77):(r=$(".popupWindow").width()-($("#dvGrdViewVehicles").width()+20),n=$(".popupWindow").height()-22),$(".map").each(function(t,i){$(i).width(r).height(n)}),$("#dvGrdViewVehicles").height(n-40)}function getAllIDs(){for(var t=[],i=$("table.VehicleList tbody tr[id]"),r=i.length,n=0;n<r;n++)t.push(i[n].id.replace(/\D/g,""));return t}var dateFormat,g_fGoogleApiLoaded,mapMinHeight,notTrackable,TrackingTemplater;(function(n){function t(n,t){var r,s,u,f,o,e,i;for(n=n.html().replace(/(^\s*)|(\s*$)/g,""),r=n.replace(/{/g,"{#").split(/[{}]{1,}/g),s=r.length,u=0;u<s;u++)r[u].indexOf("#")==0&&(f=r[u].substr(1).split("??"),o=null,f.length==2&&(o=f[1]),f[0].indexOf(":")>0?(i=f[0].split(":"),e=isNaN(i[1])===!1?t[i[0]].toFixed(parseInt(i[1])):i[1]==="trim"&&t[i[0]]!=null?t[i[0]].replace(/[ &@#$%^&*]/g,""):t[i[0]]):e=t[f[0]],r[u]=e!=null?e:o);return r.join("")}n.fn.createTemplater=function(i){return i==undefined&&(i=this.selector),this._template=n(i).remove(),this.add=function(n){var i=t(this._template,n);this.append(i)},this},n.fn.bindTemplater=function(i){return i==undefined&&(i=this.selector),this._template=n(i).clone(),this.update=function(n){var i=t(this._template,n);this.html(i)},this},n.fn.addOnce=function(n,i){var r=t(n,i);return this.append(r),this}})(jQuery),dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,r=/[^-+\dA-Z]/g,n=function(n,t){for(n=String(n),t=t||2;n.length<t;)n="0"+n;return n};return function(u,f,e){var h=dateFormat;if(arguments.length!=1||Object.prototype.toString.call(u)!="[object String]"||/\d/.test(u)||(f=u,u=undefined),u=u?new Date(u):new Date,isNaN(u))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),f.slice(0,4)=="UTC:"&&(f=f.slice(4),e=!0);var o=e?"getUTC":"get",c=u[o+"Date"](),y=u[o+"Day"](),l=u[o+"Month"](),p=u[o+"FullYear"](),s=u[o+"Hours"](),w=u[o+"Minutes"](),b=u[o+"Seconds"](),a=u[o+"Milliseconds"](),v=e?0:u.getTimezoneOffset(),k={d:c,dd:n(c),ddd:h.i18n.dayNames[y],dddd:h.i18n.dayNames[y+7],m:l+1,mm:n(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(p).slice(2),yyyy:p,h:s%12||12,hh:n(s%12||12),H:s,HH:n(s),M:w,MM:n(w),s:b,ss:n(b),l:n(a,3),L:n(a>99?Math.round(a/10):a),t:s<12?"a":"p",tt:s<12?"am":"pm",T:s<12?"A":"P",TT:s<12?"AM":"PM",Z:e?"UTC":(String(u).match(i)||[""]).pop().replace(r,""),o:(v>0?"-":"+")+n(Math.floor(Math.abs(v)/60)*100+Math.abs(v)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return f.replace(t,function(n){return n in k?k[n]:n.slice(1,n.length-1)})}}(),dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(n,t){return dateFormat(this,n,t)};var dtCh="/",minYear=1900,currentTime=new Date,maxYear=currentTime.getFullYear();String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1},String.prototype.trim=function(){return this.replace(/^[\s]+|[\s]+$/g,"")},Cookie=function(){return{Create:function(n){var i="/",r="",t;i=n.path!=undefined&&n.domain!=undefined?"; path="+n.path+"; domain="+n.domain:"; path="+i,n.expires!=undefined&&(typeof n.expires==Date?r="; expires="+n.expires:typeof n.expires=="number"&&(t=new Date,t.setTime(t.getTime()+n.expires*864e5),r="; expires="+t.toGMTString())),document.cookie=n.name+"="+n.value+r+i},GetValue:function(n){var r,u,i,t;for(n=n+"=",r=document.cookie.split(";"),u=r.length,i=0;i<u;i++)if(t=r[i],t=t.trim(),t.indexOf(n)==0)return t.substring(n.length,t.length);return null},Delete:function(n){this.Create({name:n,value:"",expires:-1})}}}(),g_fGoogleApiLoaded=!1,$(document).ready(function(){TrackingTemplater=$("table.TrackingList tbody").createTemplater("#vehicleTemplate"),$(window).resize(CenterPopups),CenterPopups(!0),Cookie.GetValue("lvc")==undefined&&$("span#spAS").hide(),$("div#dvA img#imgLiveView").click(function(){g_fGoogleApiLoaded===!1&&(document.body.style.cursor="wait",LoadGoogleApi()),LivePopup.Show(getAllIDs())}),notTrackable=$("table.VehicleList tbody tr").length-$("table.VehicleList tbody tr[id]").length,$("table.VehicleList tbody td.strike").length>0&&$("div#dvGrdViewVehicles").append("<span style='font-size:7pt;'><span class='strike'>xxx<\/span>&nbsp;-&nbsp;Please check your subscription for this device<\/span>")}),LivePopup=function(){function a(t){r=t,WaitLoaded!=undefined&&(n==null?WaitLoaded(v):h())}function v(){e(),TrackingObjectContainer.SetOptions({map:n,updateDisplayCallback:f,updateMapCallback:c,updateInterval:5e3}),h()}function h(){r==null?e():TrackingObjectContainer.Setup==!1?(TrackingObjectContainer.Clear(),TrackingObjectContainer.SetOptions({map:n,updateDisplayCallback:f,updateMapCallback:c,updateInterval:5e3}),e(),TrackingObjectContainer.Load(r),l=!0):TrackingObjectContainer.Load(r,!1),i(),u($("#divLivePopup"))}function y(){TrackingObjectContainer.Stop(),t=0,$("table.TrackingList > tbody > tr").hide(),$("table.VehicleList > tbody > tr").show()}function f(n){var t,r;if(arguments[0]===!1){TrackingObjectContainer.Stop(),u();return}t=n,t.properties!=undefined&&(t=t.properties),$("table.TrackingList tr#T"+t.Id).length==0?TrackingTemplater.add(t):(r=$("table.TrackingList tr#T"+t.Id+" > td"),r.length>0&&($(r[2]).text(t.DateFriendly),$("table.TrackingList tr#T"+t.Id+" > td > span").text(t.Speed),$(r[4]).text(t.Heading))),$("table.TrackingList tr#T"+t.Id+" td:nth-child(2) img").css("display",t.ConnectionProblem==!0?"block":"none"),i()}function e(){var i=new google.maps.LatLng(42.81,26.72),t;n==undefined&&(t={center:i,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:2,scrollwheel:!1},n=new google.maps.Map($("#dvLiveMap")[0],t),google.maps.event.trigger(n,"resize"))}function c(t,i,r){var f,e;if(arguments[0]===!1){TrackingObjectContainer.Stop(),u();return}f=n.getZoom(),t!=undefined?(i=t.getCenter(),e=$("#dvLiveMap"),f=i.lat()==0&&i.lng()==0?2:GoogleMapExtensions.GetZoomLevel(t,{height:e.height(),width:e.width()})):r!=undefined&&(f=r),n.setOptions({center:i,zoom:f})}function p(t){t==!0?(google.maps.event.addListener(n,"bounds_changed",function(){}),google.maps.event.addListener(n,"zoom_changed",function(){})):(google.maps.event.clearListeners(n,"bounds_changed"),google.maps.event.clearListeners(n,"zoom_changed"))}function u(n){n?$("#divLivePopup").show():$("#divLivePopup").hide()}function w(n){if(n.target.tagName!="A"&&n.target.tagName!="IMG"){n.preventDefault();var t=$(n.currentTarget),i=parseInt(n.currentTarget.id.replace(/\D/,""));if(t.hasClass("selected"))return t.toggleClass("selected"),TrackingObjectContainer.ClearSelected(),!1;$("table.TrackingList tr.selected").removeClass("selected"),t.toggleClass("selected"),TrackingObjectContainer.SetSelected(i)}}function i(){t==0?($("table.TrackingList tfoot").show(),$("#stopall").hide()):($("table.TrackingList tfoot").hide(),$("#stopall").show()),t==1&&n!=undefined&&o==!0&&(n.setZoom(15),o=!1),s>0&&t==s&&notTrackable==0?$("table.VehicleList tfoot").show():$("table.VehicleList tfoot").hide()}function b(){t=0,TrackingObjectContainer.Iterate(function(n,i){var u,r;t+=i.IsRunning?1:0,i.IsRunning?(f(i),$("#T"+i.properties.Id).show(),r=$("#L"+i.properties.Id),r.length>0&&r.hide()):(u=$("#T"+i.properties.Id),u.length>0&&u.hide(),r=$("#L"+i.properties.Id),r.length>0&&r.show())}),i()}var n,r,l=!1,s=$("table.VehicleList tbody tr[id]").length,t,o;return String.prototype.visualLength=function(){var n=$("#ruler");return n[0].innerHTML=this,n[0].offsetWidth},$("#btnCloseMap, #dvLivePopupCancel").click(function(){var n=[];return TrackingObjectContainer.Iterate(function(t,i){i.IsRunning&&n.push(i.Id)}),y(),u(),Cookie.Create({name:"lvc",value:n.join(",")}),$("span#spAS").show(),!1}),$("#btnForceRefresh").click(function(n){n.preventDefault(),TrackingObjectContainer.Refresh()}),$("table.TrackingList tbody tr").live("click",function(n){w(n)}),t=0,$("table.TrackingList a").live("click",function(n){n.preventDefault(),n.stopPropagation();var r=parseInt(this.hash.replace(/\D/,""));TrackingObjectContainer.Stop(r),$(this.parentNode.parentNode).removeClass("selected"),$(this.parentNode.parentNode).hide(),$("#L"+r).show(),t--,i()}),$("table.VehicleList a").click(function(n){var r,u;n.preventDefault(),$(this.parentNode.parentNode.parentNode).hide(),r=parseInt(this.hash.replace(/\D/,"")),$("#T"+r).length>0&&$("#T"+r).show(),u=TrackingObjectContainer.Start(r),t++,i()}),$("#multiSelect a, #aStopAll").click(function(n){var r,i,u;if(n.preventDefault(),r=$(this).attr("href"),r=="a"||r=="p"||r=="t")t+=TrackingObjectContainer.StartMany(r);else if(r=="stopAll")TrackingObjectContainer.Stop(),t=0;else if(r=="s"&&(i=Cookie.GetValue("lvc"),i!=null)){for(i=i.split(","),u=0;u<i.length;u++)i[u]=parseInt(i[u]);t+=i.length,TrackingObjectContainer.Start(i)}setTimeout(b,500)}),o=!0,{Show:a,setPanZoomEvent:p}}()