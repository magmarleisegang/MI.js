function RenderReport(n){var t,u,i,f,r,e;if(fBusyProcessing==!0){alert("Processing report. Please wait.");return}if($.blockUI({message:"Downloading report. Please wait...",css:{fontFamily:"Verdana",fontSize:"10pt",color:"#505050",padding:"20px"},smartCenter:!1}),fBusyProcessing=!0,t=[],u='"setCookie":',u+="true,",i=$("#txtReportName").text().replace(/(^\s*)|(\s*$)/g,""),$("#ddlZonesCategory").length==0&&$("#ddlZones").val()==""&&i=="Zone Detailed Report"){alert("Please select a zone"),$.unblockUI({fadeOut:0}),fBusyProcessing=!1;return}$("#trOutput").length>0&&(i=i+($("#trOutput input[type=radio][value=rPDF]")[0].checked?"":" (CSV)")),t[0]="{"+u+'"reportName":"'+i+'", "parameters":',t.push('[["dtStart","'+$("#txtStartDate").val()+'"]'),t.push(',["dtEnd","'+$("#txtEndDate").val()+'"]'),t.push(',["dRunningCost","'+$("#txtVehicleCostpKm").val()+'"]'),t.push(',["iZoneId","'+$("#ddlZones").val()+'"]'),t.push(',["iZoneCategoryId","'+$("#ddlZonesCategory").val()+'"]'),t.push(',["sCompanyName","'+$("#txtCompanyName").val()+'"]'),t.push(',["sDepartment","'+$("#txtCompanyDepartment").val()+'"]'),t.push(',["sEmployeeName","'+$("#txtEmployeeName").val()+'"]'),t.push(',["sEmployeeNumber","'+$("#txtEmployeeNumber").val()+'"]'),t.push(',["sEmailAddress","'+$("#txtEmployeeEmailAddress").val()+'"]'),$("#ddlVehicleTrailerSelect").length==1&&($("#ddlVehicleTrailerSelect").find(":selected").attr("data-torv")=="v"&&(t.push(',["iVehicleId","'+$("#ddlVehicleTrailerSelect").val()+'"]'),t.push(',["iTrailerId",""]')),$("#ddlVehicleTrailerSelect").find(":selected").attr("data-torv")=="t"&&(t.push(',["iTrailerId","'+$("#ddlVehicleTrailerSelect").val()+'"]'),t.push(',["iVehicleId",""]'))),$("#ddlVehicleSelect").length==1&&t.push(',["iVehicleId","'+$("#ddlVehicleSelect").val()+'"]'),t.push(',["bDesignation","'+$("#ddlDesignation").val()+'"]'),t.push(',["fToZone","'+$("#ddlToZone").val()+'"]'),t.push(',["bExpenseTypeId","'+$("#ddlExpenseType").val()+'"]'),$("#cslTripCategory").length==1?(f=GetCategories(),t.push(',["iCategoryId", "'+f+'"]'),$("#chkGroupByCategory").length>0&&t.push(',["fGroupByCategory", '+$("#chkGroupByCategory")[0].checked+"]")):t.push(',["iCategoryId", ""]'),$("#ccWeek").length>0&&(r=GetDaysAndTime(),t.push(',["aiWeekDays", "'+r.days.join(",")+'"]'),t.push(',["tStart", "'+r.start+'"]'),t.push(',["tEnd", "'+r.end+'"]')),t.push("]}"),e=t.join(""),ajaxProcessing=$.ajax({type:"POST",url:"../../ReportingWebService.asmx/RenderReport",contentType:"application/json; charset=utf-8",data:e,dataType:"json",timeout:18e4,beforeSend:ClearMessages,success:function(t){var r,u;t.d.startsWith("ER:")?(r=t.d.split(":"),n.text(r[1]),$(n[0].parentNode.parentNode).show()):($(n[0].parentNode.parentNode).hide(),u=ResolveUrl("~/PrivatePages/Reports/ReportRenderer.ashx?GUID="+t.d),trackReportDL(i),document.location=u)},error:function(n){alert(n.responseText)},complete:function(){$.unblockUI(),fBusyProcessing=!1,ajaxProcessing=null}})}function ResolveUrl(n){return n.indexOf("~/")==0&&(n=baseUrl+n.substring(2)),n}function trackReportDL(n){try{_gat._getTrackerByName()._trackEvent("Download","Report",n,0,!0)}catch(t){}}function ClearMessages(){$("#NotificationMessage").hide(),$("#ErrorMessage").hide()}function GetCategories(){if($("#cslTripCategory div.filter-box input[value='cAll']")[0].checked)return"";var t=$("#cslTripCategory div.filter-opts input"),n=0;return $.each(t,function(){this.checked&&(n+=parseInt($(this).data("cat")))}),n}function GetDaysAndTime(){var i=[],n,t;return $("#rdWeekFilter input[value=cAll]").prop("checked")?i.push(0):$("#ccWeek div.filter-opts input[type=checkbox]").each(function(n,t){t.checked===!0&&i.push($(t).data("day"))}),n=[],n.push($("#tStart select.hr").val()),n.push($("#tStart select.min").val()),n=n.join(":"),t=[],t.push($("#tEnd select.hr").val()),t.push($("#tEnd select.min").val()),t=t.join(":"),{days:i,start:n,end:t}}var ajaxProcessing=null,fBusyProcessing;$(document).ready(function(){fBusyProcessing=!1;var n=document.location.href.split("?")[1];n!=undefined&&(SetupDatepicker("#txtStartDate",{otherCalendar:"#txtEndDate",dpo:{maxDate:new Date}}),SetupDatepicker("#txtEndDate",{otherCalendar:"#txtStartDate",dpo:{maxDate:new Date}}),ZoneDdlChange("#ddlZones","#ddlZonesCategory"),ZoneDdlChange("#ddlZonesCategory","#ddlZones"),document.forms[0].action=document.forms[0].action.substr(0,document.forms[0].action.indexOf("?")),$("#btnDownloadReport").click(function(n){return n.preventDefault(),$("#dtCalendarStart").css("display","none"),$("#dtCalendarEnd").css("display","none"),RenderReport($("#txtParameterError")),!1}),$("div.filter-opts input").change(function(){$(this).data("cat")&&($("#cslTripCategory div.filter-box input[value='cSome']")[0].checked=!0)}),$("span#ccWeek div.week div.links a").click(function(n){n.preventDefault();var t=$(this).attr("href");t=="f"?$("#ccWeek input[type=checkbox]").prop("checked",!0):$("#ccWeek input[type=checkbox]").each(function(n,i){i.checked=t=="wd"?$(i).data("day")<6:$(i).data("day")>=6})}))}),ZoneDdlChange=function(n,t){$(n).change(function(){$(n).val()!=""&&$(t+" option[value=]").prop("selected",!0)})},String.prototype.startsWith=function(n){return this.indexOf(n)==0}