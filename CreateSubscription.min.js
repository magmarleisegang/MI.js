function LoadCreateSubscriptionPage(){if(rowTemplate=$("#divQuote table tbody").createTemplater("#subscriptionQuoteTemplate"),$("#divAddDevice").length>0){CheckQuote2(),$("#divAddDevice input[name=rgAddOrPay]").click(function(){$("#divAddDevice").removeClass("a p"),this.checked==!0&&$("#divAddDevice").addClass(this.value)}),$("div.deviceRegistration>h1").text("Device Registration");return}currentAjax=null,showCalc=null,curDeviceRowTemplate=$("#divQuote table tbody").createTemplater("#subscriptionQuoteTemplateCur"),currentDevice=function(){return parseInt($("#hidCurrentDevice").val())},SubscriptionList.SetSelected("ctrlSubsSelector"),SubscriptionList.SetSelected("ctrlBaseSubsSelector"),CheckQuote(!0),SubscriptionList.Bind(CheckQuote),$("#aContinue").click(function(n){$("#divQuote table tbody tr").length==0&&$("#grdUnpaidSubs tbody tr").length==0&&$("#grdSubscriptions tbody tr").length==0&&(alert("Please select subscriptions before heading off to the payment page."),n.preventDefault())}),$("span.remove").live("click",function(n){var i;n.preventDefault();var u=$(this),t=$(this).data("id"),r=t.substr(0,t.indexOf("-"));t.length>0&&(i=t.substr(t.indexOf("-")+1),r==currentDevice()&&($("div[id^=sc"+i+"] > input[type=hidden]").val(null),SubscriptionList.SetSelected(),CheckQuote()))})}function LoadPaySubscriptionPage(){$("img#btnContinue").click(function(){var n=PaymentScript.GetGatewayAndPaymentInfo();PaymentScript.CallPaymentService("../SubscriptionWebService.asmx/UserRegistrationSubscription",'{"gatewaySetting": '+n.Gateway+',"paymentInfoId":'+n.PaymentInfoId+',"sessionId":"'+Cookie.GetValue("GLB_REG_SESSION")+'"}',null,"Creating Payment")}),$("img#btnRetry").click(function(){var n=PaymentScript.GetGatewayAndPaymentInfo();PaymentScript.CallPaymentService("../SubscriptionWebService.asmx/UserRetryPayment",'{"gatewaySetting": '+n.Gateway+',"paymentInfoId":'+n.PaymentInfoId+"}",null,"Creating Payment")}),$("#ddlPaymentGateway").change(function(){$.blockUI&&$.blockUI({message:"Please wait"})})}function Calculating(n){n===!0?showCalc=setTimeout(function(){$("#pQuote_Calculating").show()},1e3):(clearTimeout(showCalc),$("#pQuote_Calculating").hide())}function CheckQuote(n){initial=n===!0;var r=SubscriptionList.GetAllSelected("ctrlBaseSubsSelector"),t=SubscriptionList.GetAllSelected("ctrlSubsSelector"),i=r[0];i!=undefined&&t.push(i),sData="",sData=initial===!0&&t.length==0?'{"subscriptionType":null,"gatewaySetting":0}':'{"subscriptionType":['+t.join(",")+'], "gatewaySetting": 1}',Calculating(!0),currentAjax!=null&&currentAjax.abort(),currentAjax=DoAjax({url:"/SubscriptionWebService.asmx/RegistrationGetSubscriptionQuote",data:sData,successCallback:function(n){var i,t;if(n.d[0]==!0){if(n.d[1].length==0){$("#divQuote").hide();return}$("#divQuote").show(),i=$("#divQuote table tbody"),i.empty(),t=0,$.each(n.d[1],function(n,i){t+=parseFloat(i.Charged),i.DeviceId==currentDevice()?(curDeviceRowTemplate.add(i),initial===!0&&$("div[id=sc"+i.CategoryId+"] > input[type=hidden]").val(i.SubscriptionTypeId)):rowTemplate.add(i)}),$("#divQuote table tfoot td.total span.total").text(t.toFixed(2)),n.d.length==3?$("#pQuote_ProR").text("* "+n.d[2]):$("#pQuote_ProR").hide(),initial===!0&&SubscriptionList.SetSelected()}},completeCallback:function(){currentAjax=null,Calculating(!1)}})}function CheckPayCookie(){var n=Cookie.GetValue("GLB_REG_SESSION");alertUI("Please give us moment to check the status of this transaction..."),DoAjax({url:"/SubscriptionWebService.asmx/CheckStage",data:'{"sessionId":"'+n+'"}',successCallback:function(n){n.d[1]==!1?n.d[2]==!1?alertUI(n.d[3]):(alertUI("This transaction has already been processed. You should be redirected soon."),document.location=n.d[2]):alertUI()},doAsync:!1})}function CheckQuote2(){currentAjax!=null&&currentAjax.abort(),currentAjax=DoAjax({url:"/SubscriptionWebService.asmx/RegistrationGetSubscriptionQuote",data:'{"subscriptionType":null,"gatewaySetting":0}',successCallback:function(n){var i,t;if(n.d[0]==!0){if(n.d[1].length==0){$("#divQuote").hide();return}$("#divQuote").show(),i=$("#divQuote table tbody"),i.empty(),t=0,$.each(n.d[1],function(n,i){t+=parseFloat(i.Charged),rowTemplate.add(i)}),$("#divQuote table tfoot td.total span.total").text(t.toFixed(2)),n.d.length==3?$("#pQuote_ProR").text("* "+n.d[2]):$("#pQuote_ProR").hide()}},completeCallback:function(){currentAjax=null,Calculating(!1)}})}var rowTemplate,currentAjax,showCalc,currentDevice,curDeviceRowTemplate;$(document).ready(function(){var n=Cookie.GetValue("rip");(n==null||n=="pay")&&CheckPayCookie(),document.location.pathname.indexOf("DRCreateSubscription")>-1?LoadCreateSubscriptionPage():document.location.pathname.indexOf("DRPaySubscription")>-1&&LoadPaySubscriptionPage()})