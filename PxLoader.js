function PxLoader(n){var o,f,r,e,c;n=n||{},n.statusInterval==null&&(n.statusInterval=5e3),n.loggingDelay==null&&(n.loggingDelay=2e4),n.noProgressTimeout==null&&(n.noProgressTimeout=Infinity);var i=[],u=[],s,h=+new Date,t={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},l=function(n){return n==null?[]:Array.isArray(n)?n:[n]};this.add=function(n){n.tags=new PxLoaderTags(n.tags),n.priority==null&&(n.priority=Infinity),i.push({resource:n,status:t.QUEUED})},this.addProgressListener=function(n,t){u.push({callback:n,tags:new PxLoaderTags(t)})},this.addCompletionListener=function(n,t){u.push({tags:new PxLoaderTags(t),callback:function(t){t.completedCount===t.totalCount&&n()}})},o=function(n){n=l(n);var t=function(t){for(var f=t.resource,r=Infinity,i,u=0;u<f.tags.length;u++)for(i=0;i<Math.min(n.length,r);i++){if(f.tags[u]==n[i]&&i<r){r=i;if(r===0)break}if(r===0)break}return r};return function(n,i){var u=t(n),r=t(i);return u<r?-1:u>r?1:n.priority<i.priority?-1:n.priority>i.priority?1:0}},this.start=function(n){var e,r,h,u;for(s=+new Date,e=o(n),i.sort(e),r=0,h=i.length;r<h;r++)u=i[r],u.status=t.WAITING,u.resource.start(this);setTimeout(f,100)},f=function(){for(var e=!1,s=+new Date-h,a=s>=n.noProgressTimeout,l=s>=n.loggingDelay,r,u=0,o=i.length;u<o;u++){r=i[u];if(r.status!==t.WAITING)continue;r.resource.checkStatus&&r.resource.checkStatus(),r.status===t.WAITING&&(a?r.resource.onTimeout():e=!0)}l&&e&&c(),e&&setTimeout(f,n.statusInterval)},this.isBusy=function(){for(var n=0,r=i.length;n<r;n++)if(i[n].status===t.QUEUED||i[n].status===t.WAITING)return!0;return!1},r=function(n,r){for(var o=null,v,a,s,c,f=0,l=i.length;f<l;f++)if(i[f].resource===n){o=i[f];break}if(o==null||o.status!==t.WAITING)return;for(o.status=r,h=+new Date,v=n.tags.length,f=0,a=u.length;f<a;f++)s=u[f],c=s.tags.length===0?!0:n.tags.contains(s.tags),c&&e(o,s)},this.onLoad=function(n){r(n,t.LOADED)},this.onError=function(n){r(n,t.ERROR)},this.onTimeout=function(n){r(n,t.TIMEOUT)},e=function(n,r){for(var s=0,o=0,u,e,f=0,h=i.length;f<h;f++)u=i[f],e=!1,e=r.tags.length===0?!0:u.resource.tags.contains(r.tags),e&&(o++,(u.status===t.LOADED||u.status===t.ERROR||u.status===t.TIMEOUT)&&s++);r.callback({resource:n.resource,loaded:n.status===t.LOADED,error:n.status===t.ERROR,timeout:n.status===t.TIMEOUT,completedCount:s,totalCount:o})},c=this.log=function(n){var e,f,o,u,r;if(!window.console)return;for(e=Math.round((+new Date-s)/1e3),window.console.log("PxLoader elapsed: "+e+" sec"),f=0,o=i.length;f<o;f++){u=i[f];if(!n&&u.status!==t.WAITING)continue;r="PxLoader: #"+f+" "+u.resource.getName();switch(u.status){case t.QUEUED:r+=" (Not Started)";break;case t.WAITING:r+=" (Waiting)";break;case t.LOADED:r+=" (Loaded)";break;case t.ERROR:r+=" (Error)";break;case t.TIMEOUT:r+=" (Timeout)"}u.resource.tags.length>0&&(r+=" Tags: ["+u.resource.tags.join(",")+"]"),window.console.log(r)}}}function PxLoaderTags(n){var i,t;this.array=[],this.object={},this.value=null,this.length=0;if(n!==null&&n!==undefined){if(Array.isArray(n))this.array=n;else if(typeof n=="object")for(i in n)this.array.push(i);else this.array.push(n),this.value=n;for(this.length=this.array.length,t=0;t<this.length;t++)this.object[this.array[t]]=!0}this.contains=function(n){if(this.length===0||n.length===0)return!1;if(this.length===1&&this.value!==null)return n.length===1?this.value===n.value:n.object.hasOwnProperty(this.value);if(n.length<this.length)return n.contains(this);for(var t in this.object)if(n.object[t])return!0;return!1}}Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"});function PxLoaderImage(n,t,i){var r=this,u=null;this.img=new Image,this.tags=t,this.priority=i;var e=function(){if(r.img.readyState=="complete"){f();u.onLoad(r)}},s=function(){f();u.onLoad(r)},o=function(){f();u.onError(r)},f=function(){r.unbind("load",s),r.unbind("readystatechange",e),r.unbind("error",o)};this.start=function(t){u=t,r.bind("load",s),r.bind("readystatechange",e),r.bind("error",o),r.img.src=n},this.checkStatus=function(){if(r.img.complete){f();u.onLoad(r)}},this.onTimeout=function(){f();if(r.img.complete)u.onLoad(r);else u.onTimeout(r)},this.getName=function(){return n},this.bind=function(n,t){r.img.addEventListener?r.img.addEventListener(n,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+n,t)},this.unbind=function(n,t){r.img.removeEventListener?r.img.removeEventListener(n,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+n,t)}}PxLoader.prototype.addImage=function(n,t,i){var r=new PxLoaderImage(n,t,i);return this.add(r),r.img}